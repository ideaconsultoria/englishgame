<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Present Tenses Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #334155;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Alinhar ao topo para melhor fluxo de conteúdo */
            min-height: 100vh;
            padding: 2rem;
            box-sizing: border-box;
        }
        .container {
            background-color: #ffffff;
            border-radius: 1.5rem; /* Cantos mais arredondados */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 2.5rem;
            max-width: 900px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        .game-section {
            border: 1px solid #e2e8f0;
            border-radius: 1rem;
            padding: 1.5rem;
            background-color: #f8fafc;
        }
        .game-title {
            font-size: 1.75rem; /* Título maior */
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .dialogue-box {
            background-color: #e0f2fe; /* Fundo azul claro */
            border-left: 5px solid #38b2ac; /* Borda teal */
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
            max-height: 400px; /* Limitar altura */
            overflow-y: auto; /* Rolagem se o conteúdo transbordar */
        }
        .dialogue-box p {
            margin-bottom: 0.75rem;
            line-height: 1.6;
        }
        .dialogue-box strong {
            color: #0d9488; /* Teal mais escuro para nomes */
        }
        .dialogue-box em {
            font-style: normal;
            font-weight: 600;
            color: #0f766e; /* Teal ainda mais escuro para palavras enfatizadas */
        }
        .fill-in-blanks-container, .qa-container, .true-false-container,
        .error-correction-container, .sentence-ordering-container,
        .sentence-transformation-container, .synonym-antonym-container,
        .flashcard-game-container, .writing-guide-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .blank-item, .qa-item, .tf-item, .correction-item, .ordering-item,
        .transformation-item, .synonym-antonym-item, .flashcard-item, .writing-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding: 0.75rem;
            background-color: #ffffff;
            border-radius: 0.75rem;
            border: 1px solid #cbd5e1;
            position: relative; /* Para posicionar o botão de reset individual */
        }
        .blank-item label, .qa-item label, .tf-item label, .correction-item label,
        .ordering-item label, .transformation-item label, .synonym-antonym-item label,
        .flashcard-item label, .writing-item label {
            font-weight: 600;
            color: #475569;
        }
        .blank-item input, .qa-item input, .qa-item textarea, .flashcard-item input,
        .flashcard-item textarea, .correction-item textarea, .ordering-item input,
        .transformation-item textarea, .synonym-antonym-item select, .writing-item textarea {
            padding: 0.75rem;
            border: 1px solid #94a3b8;
            border-radius: 0.5rem;
            font-size: 1rem;
            width: 100%;
            box-sizing: border-box;
            resize: vertical; /* Permite redimensionar textareas */
        }
        .feedback {
            margin-top: 0.5rem;
            font-weight: 600;
        }
        .correct {
            color: #10b981; /* Verde */
        }
        .incorrect {
            color: #ef4444; /* Vermelho */
        }
        .button-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
        }
        .action-button {
            padding: 0.75rem 1.5rem;
            background-color: #3b82f6; /* Azul */
            color: white;
            border: none;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .action-button:hover {
            background-color: #2563eb;
            transform: translateY(-2px);
        }
        .action-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .individual-reset-button {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background-color: #ef4444; /* Vermelho */
            color: white;
            border: none;
            border-radius: 0.5rem;
            padding: 0.3rem 0.6rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .individual-reset-button:hover {
            background-color: #dc2626;
        }
        .score-display {
            text-align: center;
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 0.75rem;
            background-color: #e0f2fe;
            color: #0d9488;
        }
        /* Estilo para termos destacados nos flashcards */
        .flashcard-term {
            font-weight: 700;
            color: #0d9488; /* Teal mais escuro */
            background-color: #d1fae5; /* Fundo verde claro */
            padding: 0.2rem 0.4rem;
            border-radius: 0.3rem;
        }
        .flashcard-example {
            font-style: italic;
            color: #475569;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        .scrambled-words {
            font-weight: bold;
            color: #3b82f6;
            margin-bottom: 0.5rem;
        }

        /* Estilos do Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s, opacity 0.3s ease;
        }
        .modal-overlay.visible {
            visibility: visible;
            opacity: 1;
        }
        .modal-content {
            background-color: #ffffff;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 700px;
            width: 90%;
            max-height: 90vh; /* Limitar altura para rolagem */
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }
        .modal-overlay.visible .modal-content {
            transform: translateY(0);
        }
        .modal-close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #64748b;
        }
        .modal-close-button:hover {
            color: #1e293b;
        }
        .modal-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .modal-score-summary {
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 1.5rem;
            color: #0d9488;
        }
        .modal-incorrect-answers h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e293b;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 0.5rem;
        }
        .modal-incorrect-answers ul {
            list-style: none;
            padding-left: 0;
        }
        .modal-incorrect-answers li {
            margin-bottom: 0.75rem;
            padding: 0.5rem;
            background-color: #fef2f2; /* Light red for incorrect items */
            border-left: 4px solid #ef4444; /* Red border */
            border-radius: 0.5rem;
        }
        .modal-incorrect-answers .correct-answer {
            font-weight: 600;
            color: #10b981; /* Green for correct answer */
        }
        .modal-incorrect-answers .user-answer {
            font-style: italic;
            color: #475569;
        }
        .writing-guide-content {
            background-color: #ecfdf5; /* Light green background */
            border: 1px solid #a7f3d0;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .writing-guide-content h4 {
            font-size: 1.1rem;
            font-weight: 700;
            color: #0d9488;
            margin-bottom: 0.5rem;
        }
        .writing-guide-content ul {
            list-style: disc;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }
        .writing-guide-content p {
            margin-bottom: 0.5rem;
        }
        .writing-guide-content .highlight-instruction {
            font-style: italic;
            color: #475569;
            margin-top: 1rem;
            padding-top: 0.5rem;
            border-top: 1px dashed #cbd5e1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-4xl font-extrabold text-center text-gray-900 mb-6">Dominando os Tempos Presentes</h1>

        <!-- Seção do Diálogo -->
        <div class="game-section">
            <h2 class="game-title">Diálogo de Conversação: Um Dia na Vida</h2>
            <div class="dialogue-box" id="dialogueBox">
                <!-- O conteúdo do diálogo será inserido aqui pelo JavaScript -->
            </div>
            <p class="text-center text-sm text-gray-600 mt-4">Leia o diálogo cuidadosamente, prestando atenção aos verbos em **negrito** e *itálico*.</p>
        </div>

        <!-- Jogo de Preencher Lacunas -->
        <div class="game-section">
            <h2 class="game-title">Preencha as Lacunas: Complete as Frases</h2>
            <p class="text-center text-sm text-gray-600 mb-4">Complete as frases usando a forma correta do verbo entre parênteses (Present Simple ou Present Continuous).</p>
            <div class="fill-in-blanks-container" id="fillInBlanksContainer">
                <!-- As lacunas serão geradas aqui pelo JavaScript -->
            </div>
            <div id="fillInBlanksScore" class="score-display hidden"></div>
        </div>

        <!-- Jogo de Criar Perguntas/Respostas -->
        <div class="game-section">
            <h2 class="game-title">Desafio de Perguntas e Respostas</h2>
            <p class="text-center text-sm text-gray-600 mb-4">Para cada afirmação, **crie uma pergunta** que a afirmação responde, ou **crie uma resposta** para a pergunta dada, usando o tempo verbal presente correto.</p>
            <div class="qa-container" id="qaContainer">
                <!-- Os itens de Q&A serão gerados aqui pelo JavaScript -->
            </div>
            <div id="qaScore" class="score-display hidden"></div>
        </div>

        <!-- Jogo de Verdadeiro ou Falso -->
        <div class="game-section">
            <h2 class="game-title">Desafio Verdadeiro ou Falso</h2>
            <p class="text-center text-sm text-gray-600 mb-4">Leia a afirmação e decida se é Verdadeira ou Falsa com base no diálogo.</p>
            <div class="true-false-container" id="trueFalseContainer">
                <!-- Os itens de True/False serão gerados aqui pelo JavaScript -->
            </div>
            <div id="trueFalseScore" class="score-display hidden"></div>
        </div>

        <!-- Nova Atividade: Correção de Erros -->
        <div class="game-section">
            <h2 class="game-title">Correção de Erros: Present Simple e Present Continuous</h2>
            <p class="text-center text-sm text-gray-600 mb-4">Leia as frases e corrija os erros de uso do Present Simple ou Present Continuous. Reescreva a frase corretamente.</p>
            <div class="error-correction-container" id="errorCorrectionContainer">
                <!-- Itens de correção de erros serão gerados aqui -->
            </div>
            <div id="errorCorrectionScore" class="score-display hidden"></div>
        </div>

        <!-- Nova Atividade: Ordenar Frases -->
        <div class="game-section">
            <h2 class="game-title">Ordenar Frases: Reconstrua as Sentenças</h2>
            <p class="text-center text-sm text-gray-600 mb-4">As palavras estão embaralhadas. Ordene-as para formar uma frase gramaticalmente correta, focando nos tempos presentes.</p>
            <div class="sentence-ordering-container" id="sentenceOrderingContainer">
                <!-- Itens de ordenação de frases serão gerados aqui -->
            </div>
            <div id="sentenceOrderingScore" class="score-display hidden"></div>
        </div>

        <!-- Nova Atividade: Transformação de Frases -->
        <div class="game-section">
            <h2 class="game-title">Transformação de Frases: Afirmativa, Negativa, Interrogativa</h2>
            <p class="text-center text-sm text-gray-600 mb-4">Transforme as frases para a forma indicada (negativa, afirmativa ou interrogativa), usando os verbos do texto.</p>
            <div class="sentence-transformation-container" id="sentenceTransformationContainer">
                <!-- Itens de transformação de frases serão gerados aqui -->
            </div>
            <div id="sentenceTransformationScore" class="score-display hidden"></div>
        </div>

        <!-- Nova Atividade: Sinônimos e Antônimos -->
        <div class="game-section">
            <h2 class="game-title">Sinônimos e Antônimos: Escolha a Melhor Opção</h2>
            <p class="text-center text-sm text-gray-600 mb-4">Para cada palavra destacada, escolha a opção que melhor se encaixa como sinônimo ou antônimo, de acordo com o contexto do diálogo.</p>
            <div class="synonym-antonym-container" id="synonymAntonymContainer">
                <!-- Itens de sinônimos/antônimos serão gerados aqui -->
            </div>
            <div id="synonymAntonymScore" class="score-display hidden"></div>
        </div>

        <!-- Jogo de Flashcards de Vocabulário -->
        <div class="game-section">
            <h2 class="game-title">Flashcards de Vocabulário de Trabalho</h2>
            <p class="text-center text-sm text-gray-600 mb-4">Para cada termo ou expressão, faça suas anotações e crie uma frase usando o vocabulário alvo.</p>
            <div class="flashcard-game-container" id="flashcardGameContainer">
                <!-- Os flashcards serão gerados aqui pelo JavaScript -->
            </div>
            <div id="flashcardScore" class="score-display hidden"></div>
        </div>

        <!-- Nova Atividade: Guia de Escrita (Sem Gabarito Automático) -->
        <div class="game-section">
            <h2 class="game-title">Guia de Escrita: Crie seu Próprio Texto</h2>
            <p class="text-center text-sm text-gray-600 mb-4">Use as estruturas obrigatórias, o vocabulário e as ideias do diálogo para escrever um pequeno texto sobre sua rotina de trabalho, hobbies ou características pessoais. Use Present Simple e Present Continuous.</p>
            <p class="text-center text-sm text-gray-600 mb-4 highlight-instruction">**Dica:** Anote e destaque do texto e das atividades quais expressões ou construções você achou importantes e quer usar em seu próprio texto!</p>
            <div class="writing-guide-content">
                <h4>Prompts Sugeridos:</h4>
                <ul>
                    <li>Descreva sua rotina diária de trabalho/estudo, usando Present Simple.</li>
                    <li>Fale sobre o que você está fazendo *agora* (Present Continuous) ou planos para o futuro próximo.</li>
                    <li>Compartilhe seus gostos e desgostos (likes and dislikes).</li>
                    <li>Descreva sua cidade ou o lugar onde você mora.</li>
                </ul>
                <h4>Estruturas Obrigatórias (Use todas em seu texto):</h4>
                <ul>
                    <li>**Busy**</li>
                    <li>**Tight schedule**</li>
                    <li>**Try to get everything finalized before the end of the month**</li>
                    <li>**Currently**</li>
                    <li>**Review proposal**</li>
                    <li>**Manage the lifecycle of**</li>
                    <li>**Work closely with**</li>
                    <li>**My main responsibility is**</li>
                    <li>**I also deal with…**</li>
                </ul>
            </div>
            <label for="studentWriting" class="font-semibold text-lg mb-2">Seu Texto:</label>
            <textarea id="studentWriting" class="w-full p-3 border border-gray-400 rounded-lg" rows="10" placeholder="Comece a escrever seu texto aqui..."></textarea>
            <p class="text-sm text-gray-600 mt-2">Este texto não será corrigido automaticamente. Salve-o em seu caderno online ou documento pessoal.</p>
        </div>


        <!-- Botão de Verificação Global -->
        <div class="button-group">
            <button class="action-button" onclick="checkAllActivities()">Verificar Todas as Atividades</button>
        </div>
    </div>

    <!-- Modal de Resumo -->
    <div id="summaryModalOverlay" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-button" onclick="closeSummaryModal()">&times;</button>
            <h2 class="modal-title">Resultados das Atividades</h2>
            <p id="overallScore" class="modal-score-summary"></p>
            <div id="incorrectAnswersSummary" class="modal-incorrect-answers">
                <!-- Conteúdo das respostas incorretas será inserido aqui -->
            </div>
        </div>
    </div>

    <script>
        // Conteúdo do diálogo
        const dialogueContent = `
            <p><strong>Alex:</strong> Hi Ben! It's great to see you again. How <em>are you doing</em> today? You <em>look</em> a bit busy, as usual!</p>
            <p><strong>Ben:</strong> Hi Alex! Good to see you too! I'm doing well, thanks. Yes, I <strong>am working</strong> on a tight deadline for a new substation project, so I <strong>am feeling</strong> a little stressed, but it's exciting! We <strong>are trying</strong> to get everything finalized before the end of the month. And you? How <strong>are things going</strong> with you?</p>
            <p><strong>Alex:</strong> I'm good, thanks! I <strong>am currently reviewing</strong> some network upgrade proposals for a big client. It’s always something new and fast-paced in telecom, isn't it? So, tell me, what <strong>are you working on</strong> these days? What <strong>is your role</strong> as a project analyst in electric projects? I know the basics, but tell me more.</p>
            <p><strong>Ben:</strong> Well, you know I <strong>manage</strong> the lifecycle of electrical infrastructure projects. This usually <strong>involves</strong> planning, executing, and closing projects. I <strong>work</strong> closely with engineers and contractors. My main responsibility <strong>is to ensure</strong> that projects stay on schedule and within budget. I also <strong>deal</strong> with a lot of regulatory compliance. It <strong>is</strong> a lot of paperwork!</p>
            <p><strong>Alex:</strong> It sounds quite complex, indeed! What kind of personal characteristics <strong>do you think</strong> are most important for your job? I remember we talked about this briefly last time.</p>
            <p><strong>Ben:</strong> I believe strong organizational skills <strong>are essential</strong>, and you definitely <strong>need</strong> to be detail-oriented. Problem-solving abilities <strong>are</strong> also crucial, because unexpected issues <strong>always come up</strong>. And, of course, good communication <strong>helps</strong> a lot when you <strong>are coordinating</strong> different teams. What about you? What <strong>do you find</strong> important in your role? </p>
            <p><strong>Alex:</strong> I totally agree! Communication <strong>is key</strong> in my role too. I <strong>am responsible for</strong> telecom projects, primarily focusing on fiber optic deployments and 5G network expansions. I <strong>live</strong> in Rio de Janeiro, and our main office <strong>is located</strong> downtown. My family <strong>lives</strong> here too. Where <strong>do you live</strong> these days? Are you still in São Paulo?</p>
            <p><strong>Ben:</strong> Yes, I <strong>live</strong> in São Paulo. It’s a very dynamic city, much like Rio, but with its own unique energy. My office <strong>is</strong> in the industrial district here. My parents <strong>visit</strong> me often, as they <strong>live</strong> in a smaller town nearby. What <strong>do you like</strong> most about living in Rio? I remember you <strong>love</strong> the beaches.</p>
            <p><strong>Alex:</strong> Oh, I <strong>love</strong> the beaches and the vibrant culture! I often <strong>go</strong> for a run along Copacabana beach in the mornings. The weather <strong>is usually</strong> sunny. Right now, I <strong>am planning</strong> a trip to the Christ the Redeemer statue with some friends who <strong>are visiting</strong> next week. They <strong>are coming</strong> from Europe for the first time. What <strong>do you like</strong> to do in your free time in São Paulo? Are you still playing football?</p>
            <p><strong>Ben:</strong> I <strong>enjoy</strong> exploring new restaurants and art galleries. São Paulo <strong>has</strong> an incredible food scene. This weekend, I <strong>am trying</strong> a new Japanese fusion place that just opened. Yes, I also <strong>play</strong> football with a group of friends every Saturday. We <strong>are currently practicing</strong> for a local tournament, so we <strong>are meeting</strong> twice a week now. It <strong>is</strong> a lot of fun!</p>
            <p><strong>Alex:</strong> That sounds great! So, regarding your work routine, what <strong>does a typical day look like</strong> for you now? Has anything changed since we last spoke?</p>
            <p><strong>Ben:</strong> A typical day still <strong>starts</strong> with checking emails and project dashboards. I usually <strong>have</strong> a stand-up meeting with my team around 9 AM. After that, I <strong>spend</strong> a lot of time reviewing progress reports, updating schedules, and communicating with stakeholders. This afternoon, for example, I <strong>am preparing</strong> a presentation for the board about the new substation project. My boss <strong>is expecting</strong> it by 5 PM.</p>
            <p><strong>Alex:</strong> My routine <strong>is</strong> quite similar! I also <strong>start</strong> with emails. Then, I often <strong>attend</strong> virtual meetings with clients or vendors. Today, I <strong>am participating</strong> in a workshop on new cybersecurity protocols for our 5G infrastructure. It <strong>is getting</strong> more and more complex! I <strong>am always learning</strong> something new, which I <strong>like</strong>.</p>
            <p><strong>Ben:</strong> Exactly! It <strong>is</strong> a field where you <strong>are constantly adapting</strong>. What <strong>do you dislike</strong> about your job, if anything? I know every job <strong>has</strong> its challenges.</p>
            <p><strong>Alex:</strong> Sometimes, the bureaucratic processes <strong>can be</strong> a bit frustrating, and the long hours <strong>are</strong> challenging, especially when a project <strong>is facing</strong> delays. But overall, I <strong>am enjoying</strong> the challenges and the opportunity to work with cutting-edge technology. My team <strong>is working</strong> very hard right now on a new initiative, and we <strong>are making</strong> good progress. And you?</p>
            <p><strong>Ben:</strong> I sometimes <strong>find</strong> the sheer volume of regulations overwhelming, and sometimes, unexpected site issues <strong>are causing</strong> significant delays, which <strong>is</strong> tough. But the satisfaction of seeing a critical infrastructure project completed <strong>makes</strong> it all worthwhile. We <strong>are currently celebrating</strong> the completion of a major power line upgrade.</p>
            <p><strong>Alex:</strong> I completely understand that feeling! It was great catching up, Ben. I <strong>have</strong> to jump to another meeting now. My next call <strong>is starting</strong> in five minutes.</p>
            <p><strong>Ben:</strong> You too, Alex! Good luck with your projects and enjoy your friends' visit!</p>
        `;

        document.getElementById('dialogueBox').innerHTML = dialogueContent;

        // --- Lógica do Jogo de Preencher Lacunas ---
        const fillInBlanksData = [
            { sentence: "Ben (work) on a tight deadline for a new substation project right now.", answer: "is working" },
            { sentence: "Alex (currently / review) some network upgrade proposals.", answer: "is currently reviewing" },
            { sentence: "Ben usually (manage) several projects at once.", answer: "manages" },
            { sentence: "What kind of personal characteristics (you / think) are important for your job?", answer: "do you think" },
            { sentence: "Alex (live) in Rio de Janeiro.", answer: "lives" },
            { sentence: "His family also (live) there.", answer: "lives" },
            { sentence: "Ben's parents (visit) him often.", answer: "visit" },
            { sentence: "Alex's friends (visit) next week, so he (plan) a trip to Christ the Redeemer.", answer: ["are visiting", "is planning"] },
            { sentence: "The weather in Rio (usually / be) sunny.", answer: "is usually" },
            { sentence: "São Paulo (have) an incredible food scene.", answer: "has" },
            { sentence: "This weekend, Ben (try) a new Japanese fusion place.", answer: "is trying" },
            { sentence: "Ben (play) football with a group of friends every Saturday.", answer: "plays" },
            { sentence: "They (currently / practice) for a local tournament.", answer: "are currently practicing" },
            { sentence: "A typical day (start) with checking emails.", answer: "starts" },
            { sentence: "Ben (prepare) a presentation for the board this afternoon.", answer: "is preparing" },
            { sentence: "Alex (participate) in a workshop on new cybersecurity protocols today.", answer: "is participating" },
            { sentence: "It (get) more and more complex!", answer: "is getting" },
            { sentence: "Alex (always / learn) something new.", answer: "is always learning" },
            { sentence: "Alex's team (work) very hard right now on a new initiative.", answer: "is working" },
            { sentence: "They (make) good progress.", answer: "are making" },
            { sentence: "Unexpected site issues (cause) significant delays right now.", answer: "are causing" },
            { sentence: "Alex's next call (start) in five minutes.", answer: "is starting" }
        ];

        const fillInBlanksContainer = document.getElementById('fillInBlanksContainer');
        const fillInBlanksScoreDisplay = document.getElementById('fillInBlanksScore');

        function generateFillInBlanks() {
            fillInBlanksContainer.innerHTML = '';
            fillInBlanksData.forEach((item, index) => {
                const blankItem = document.createElement('div');
                blankItem.className = 'blank-item';

                let sentenceHtml = item.sentence;
                if (Array.isArray(item.answer)) {
                    let inputIndex = 0;
                    sentenceHtml = sentenceHtml.replace(/\((.*?)\)/g, () => {
                        const inputId = `blank-${index}-${inputIndex}`;
                        inputIndex++;
                        return `<input type="text" id="${inputId}" data-index="${index}" data-input-index="${inputIndex - 1}" class="inline-block w-32 px-2 py-1 border border-gray-400 rounded-md">`;
                    });
                } else {
                    sentenceHtml = sentenceHtml.replace(/\((.*?)\)/, `<input type="text" id="blank-${index}" data-index="${index}" class="inline-block w-32 px-2 py-1 border border-gray-400 rounded-md">`);
                }

                blankItem.innerHTML = `
                    <label>${index + 1}. ${sentenceHtml}</label>
                    <button class="individual-reset-button" onclick="resetIndividualBlank(${index})">Reset</button>
                    <div id="feedback-blank-${index}" class="feedback"></div>
                `;
                fillInBlanksContainer.appendChild(blankItem);
            });
        }

        function resetIndividualBlank(index) {
            const item = fillInBlanksData[index];
            if (Array.isArray(item.answer)) {
                item.answer.forEach((_, inputIdx) => {
                    const inputElement = document.getElementById(`blank-${index}-${inputIdx}`);
                    if (inputElement) inputElement.value = '';
                });
            } else {
                const inputElement = document.getElementById(`blank-${index}`);
                if (inputElement) inputElement.value = '';
            }
            const feedbackElement = document.getElementById(`feedback-blank-${index}`);
            feedbackElement.textContent = '';
            feedbackElement.className = 'feedback'; // Resetar classes
        }

        // Função para verificar e retornar resultados, sem exibir feedback imediato
        function checkFillInBlanksAndGetResults() {
            let correctCount = 0;
            let incorrectCount = 0;
            const incorrectItems = [];

            fillInBlanksData.forEach((item, index) => {
                let isItemCorrect = true;
                let userAnswerText = [];

                if (Array.isArray(item.answer)) {
                    item.answer.forEach((ans, inputIdx) => {
                        const inputElement = document.getElementById(`blank-${index}-${inputIdx}`);
                        const userVal = inputElement ? inputElement.value.trim() : '';
                        userAnswerText.push(userVal);
                        if (userVal.toLowerCase() !== ans.toLowerCase()) {
                            isItemCorrect = false;
                        }
                    });
                } else {
                    const inputElement = document.getElementById(`blank-${index}`);
                    const userVal = inputElement ? inputElement.value.trim() : '';
                    userAnswerText.push(userVal);
                    if (userVal.toLowerCase() !== item.answer.toLowerCase()) {
                        isItemCorrect = false;
                    }
                }

                if (isItemCorrect) {
                    correctCount++;
                } else {
                    incorrectCount++;
                    incorrectItems.push({
                        activity: "Preencher Lacunas",
                        question: item.sentence.replace(/\((.*?)\)/g, '_____'), // Mostrar a frase com lacunas
                        userAnswer: userAnswerText.join(' / '),
                        correctAnswer: Array.isArray(item.answer) ? item.answer.join(' / ') : item.answer
                    });
                }
            });
            return { correct: correctCount, incorrect: incorrectCount, incorrectItems: incorrectItems };
        }

        // --- Lógica do Jogo de Criar Perguntas/Respostas ---
        const qaData = [
            { type: 'answer', prompt: "Question: What is Ben working on right now?", correctResponse: "He is working on a new substation project.", example: "He is working on a new substation project." },
            { type: 'question', prompt: "Answer: Alex is currently reviewing network upgrade proposals.", correctResponse: "What is Alex currently reviewing?", example: "What is Alex currently reviewing?" },
            { type: 'answer', prompt: "Question: Where does Alex live?", correctResponse: "He lives in Rio de Janeiro.", example: "He lives in Rio de Janeiro." },
            { type: 'question', prompt: "Answer: Ben enjoys exploring new restaurants and art galleries in his free time.", correctResponse: "What does Ben enjoy doing in his free time?", example: "What does Ben enjoy doing in his free time?" },
            { type: 'answer', prompt: "Question: What is Alex always learning?", correctResponse: "He is always learning something new.", example: "He is always learning something new." },
            { type: 'question', prompt: "Answer: A typical day for Ben starts with checking emails and project dashboards.", correctResponse: "How does a typical day start for Ben?", example: "How does a typical day start for Ben?" },
            { type: 'answer', prompt: "Question: What are Alex's friends doing next week?", correctResponse: "His friends are visiting next week.", example: "His friends are visiting next week." },
            { type: 'question', prompt: "Answer: Ben is trying a new Japanese fusion place this weekend.", correctResponse: "What is Ben trying this weekend?", example: "What is Ben trying this weekend?" },
            { type: 'answer', prompt: "Question: What is Ben's main responsibility?", correctResponse: "His main responsibility is to ensure that projects stay on schedule and within budget.", example: "His main responsibility is to ensure that projects stay on schedule and within budget." },
            { type: 'question', prompt: "Answer: Alex often goes for a run along Copacabana beach in the mornings.", correctResponse: "What does Alex often do in the mornings?", example: "What does Alex often do in the mornings?" }
        ];

        const qaContainer = document.getElementById('qaContainer');
        const qaScoreDisplay = document.getElementById('qaScore');

        function generateQA() {
            qaContainer.innerHTML = '';
            qaData.forEach((item, index) => {
                const qaItem = document.createElement('div');
                qaItem.className = 'qa-item';
                qaItem.innerHTML = `
                    <label>${index + 1}. ${item.prompt}</label>
                    <textarea id="qa-input-${index}" placeholder="Sua ${item.type} aqui..."></textarea>
                    <button class="individual-reset-button" onclick="resetIndividualQA(${index})">Reset</button>
                    <div id="feedback-qa-${index}" class="feedback"></div>
                `;
                qaContainer.appendChild(qaItem);
            });
        }

        function resetIndividualQA(index) {
            const inputElement = document.getElementById(`qa-input-${index}`);
            const feedbackElement = document.getElementById(`feedback-qa-${index}`);
            if (inputElement) inputElement.value = '';
            if (feedbackElement) {
                feedbackElement.textContent = '';
                feedbackElement.className = 'feedback'; // Resetar classes
            }
        }

        // Função para verificar e retornar resultados, sem exibir feedback imediato
        function checkQAAndGetResults() {
            let correctCount = 0;
            let incorrectCount = 0;
            const incorrectItems = [];

            qaData.forEach((item, index) => {
                const inputElement = document.getElementById(`qa-input-${index}`);
                const userAnswer = inputElement ? inputElement.value.trim() : '';
                const correctAnswer = item.correctResponse.toLowerCase();

                let isCorrect = userAnswer.toLowerCase().includes(correctAnswer.slice(0, Math.min(correctAnswer.length, 10))) && userAnswer.length > 5;

                if (isCorrect) {
                    correctCount++;
                } else {
                    incorrectCount++;
                    incorrectItems.push({
                        activity: "Desafio de Perguntas e Respostas",
                        question: item.prompt,
                        userAnswer: userAnswer,
                        correctAnswer: item.correctResponse
                    });
                }
            });
            return { correct: correctCount, incorrect: incorrectCount, incorrectItems: incorrectItems };
        }

        // --- Lógica do Jogo de Verdadeiro ou Falso ---
        const trueFalseData = [
            { statement: "Ben is currently working on a new bridge project.", correct: false, explanation: "Ele está trabalhando em um projeto de subestação." },
            { statement: "Alex's main office is located downtown in Rio de Janeiro.", correct: true, explanation: "O diálogo afirma que seu escritório principal fica no centro da cidade." },
            { statement: "Ben's parents live in São Paulo.", correct: false, explanation: "Eles moram em uma cidade menor próxima." },
            { statement: "Alex's friends are visiting from Asia next week.", correct: false, explanation: "Eles estão vindo da Europa." },
            { statement: "Ben enjoys exploring new restaurants in São Paulo.", correct: true, explanation: "Ele menciona isso como um hobby." }
        ];

        const trueFalseContainer = document.getElementById('trueFalseContainer');
        const trueFalseScoreDisplay = document.getElementById('trueFalseScore');

        function generateTrueFalse() {
            trueFalseContainer.innerHTML = '';
            trueFalseData.forEach((item, index) => {
                const tfItem = document.createElement('div');
                tfItem.className = 'tf-item';
                tfItem.innerHTML = `
                    <label>${index + 1}. ${item.statement}</label>
                    <div class="flex gap-4 mt-2">
                        <label class="inline-flex items-center">
                            <input type="radio" name="tf-${index}" value="true" class="form-radio text-blue-600">
                            <span class="ml-2">Verdadeiro</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="tf-${index}" value="false" class="form-radio text-blue-600">
                            <span class="ml-2">Falso</span>
                        </label>
                    </div>
                    <button class="individual-reset-button" onclick="resetIndividualTrueFalse(${index})">Reset</button>
                    <div id="feedback-tf-${index}" class="feedback"></div>
                `;
                trueFalseContainer.appendChild(tfItem);
            });
        }

        function resetIndividualTrueFalse(index) {
            const feedbackElement = document.getElementById(`feedback-tf-${index}`);
            if (feedbackElement) {
                feedbackElement.textContent = '';
                feedbackElement.className = 'feedback'; // Resetar classes
            }
            const radioButtons = document.querySelectorAll(`input[name="tf-${index}"]`);
            radioButtons.forEach(radio => radio.checked = false);
        }

        // Função para verificar e retornar resultados, sem exibir feedback imediato
        function checkTrueFalseAndGetResults() {
            let correctCount = 0;
            let incorrectCount = 0;
            const incorrectItems = [];

            trueFalseData.forEach((item, index) => {
                const selectedOption = document.querySelector(`input[name="tf-${index}"]:checked`);
                const userAnswer = selectedOption ? selectedOption.value === 'true' : null; // null se não selecionado

                let isCorrect = (userAnswer !== null && userAnswer === item.correct);

                if (isCorrect) {
                    correctCount++;
                } else {
                    incorrectCount++;
                    incorrectItems.push({
                        activity: "Desafio Verdadeiro ou Falso",
                        question: item.statement,
                        userAnswer: (userAnswer === true ? 'Verdadeiro' : (userAnswer === false ? 'Falso' : 'Nenhuma resposta')),
                        correctAnswer: item.correct ? 'Verdadeiro' : 'Falso',
                        explanation: item.explanation
                    });
                }
            });
            return { correct: correctCount, incorrect: incorrectCount, incorrectItems: incorrectItems };
        }

        // --- Nova Atividade: Correção de Erros ---
        const errorCorrectionData = [
            { sentence: "Alex is usually go for a run in the mornings.", correct: "Alex usually goes for a run in the mornings.", explanation: "Uso incorreto do Present Simple: 'usually goes' e não 'is usually go'." },
            { sentence: "Ben managing the lifecycle of projects.", correct: "Ben manages the lifecycle of projects.", explanation: "Faltou o verbo 'to be' para Present Continuous ou deveria ser Present Simple." },
            { sentence: "What you are doing in your free time?", correct: "What do you do in your free time?", explanation: "Erro na estrutura da pergunta com Present Simple." },
            { sentence: "My boss is expecting it by 5 PM, so I prepare a presentation.", correct: "My boss is expecting it by 5 PM, so I am preparing a presentation.", explanation: "Ação temporária e em andamento, deve ser Present Continuous." },
            { sentence: "Alex always learns something new.", correct: "Alex is always learning something new.", explanation: "Com 'always' para expressar algo que acontece frequentemente e é notável, usamos Present Continuous." },
            { sentence: "The bureaucratic processes can be frustrating.", correct: "The bureaucratic processes can be frustrating.", explanation: "A frase já está correta. 'Can be' é Present Simple." },
            { sentence: "We are currently celebrate the completion.", correct: "We are currently celebrating the completion.", explanation: "Erro na forma do verbo após 'are' no Present Continuous." }
        ];

        const errorCorrectionContainer = document.getElementById('errorCorrectionContainer');
        const errorCorrectionScoreDisplay = document.getElementById('errorCorrectionScore');

        function generateErrorCorrection() {
            errorCorrectionContainer.innerHTML = '';
            errorCorrectionData.forEach((item, index) => {
                const correctionItem = document.createElement('div');
                correctionItem.className = 'correction-item';
                correctionItem.innerHTML = `
                    <label>${index + 1}. Frase com erro: "${item.sentence}"</label>
                    <textarea id="correction-input-${index}" placeholder="Reescreva a frase corretamente..."></textarea>
                    <button class="individual-reset-button" onclick="resetIndividualCorrection(${index})">Reset</button>
                    <div id="feedback-correction-${index}" class="feedback"></div>
                `;
                errorCorrectionContainer.appendChild(correctionItem);
            });
        }

        function resetIndividualCorrection(index) {
            document.getElementById(`correction-input-${index}`).value = '';
            const feedbackElement = document.getElementById(`feedback-correction-${index}`);
            if (feedbackElement) {
                feedbackElement.textContent = '';
                feedbackElement.className = 'feedback';
            }
        }

        function checkErrorCorrectionAndGetResults() {
            let correctCount = 0;
            let incorrectCount = 0;
            const incorrectItems = [];

            errorCorrectionData.forEach((item, index) => {
                const inputElement = document.getElementById(`correction-input-${index}`);
                const userAnswer = inputElement ? inputElement.value.trim() : '';

                // Verificação simples: se a resposta do usuário contém a resposta correta (ignorando maiúsculas/minúsculas)
                // e tem um tamanho razoável. Pode ser aprimorada com regex ou NLP para maior precisão.
                let isCorrect = userAnswer.toLowerCase().includes(item.correct.toLowerCase()) && userAnswer.length > (item.correct.length * 0.7);

                if (isCorrect) {
                    correctCount++;
                } else {
                    incorrectCount++;
                    incorrectItems.push({
                        activity: "Correção de Erros",
                        question: item.sentence,
                        userAnswer: userAnswer,
                        correctAnswer: item.correct,
                        explanation: item.explanation
                    });
                }
            });
            return { correct: correctCount, incorrect: incorrectCount, incorrectItems: incorrectItems };
        }

        // --- Nova Atividade: Ordenar Frases ---
        const sentenceOrderingData = [
            { scrambled: ["working", "I", "on", "am", "deadline", "a", "tight"], correct: "I am working on a tight deadline.", hint: "Começa com 'I'." },
            { scrambled: ["do", "you", "what", "free", "time", "in", "your", "do", "?"], correct: "What do you do in your free time?", hint: "É uma pergunta sobre rotina." },
            { scrambled: ["network", "reviewing", "upgrade", "proposals", "currently", "I", "am", "some"], correct: "I am currently reviewing some network upgrade proposals.", hint: "Ação acontecendo agora." },
            { scrambled: ["live", "in", "Rio de Janeiro", "I"], correct: "I live in Rio de Janeiro.", hint: "Fato sobre moradia." },
            { scrambled: ["football", "every", "play", "Saturday", "I"], correct: "I play football every Saturday.", hint: "Hábito semanal." },
            { scrambled: ["is", "more", "and", "complex", "getting", "it", "more"], correct: "It is getting more and more complex.", hint: "Situação em mudança." }
        ];

        const sentenceOrderingContainer = document.getElementById('sentenceOrderingContainer');
        const sentenceOrderingScoreDisplay = document.getElementById('sentenceOrderingScore');

        function generateSentenceOrdering() {
            sentenceOrderingContainer.innerHTML = '';
            sentenceOrderingData.forEach((item, index) => {
                const orderingItem = document.createElement('div');
                orderingItem.className = 'ordering-item';
                orderingItem.innerHTML = `
                    <label>${index + 1}. Ordene as palavras:</label>
                    <p class="scrambled-words">${item.scrambled.join(' ')}</p>
                    <input type="text" id="ordering-input-${index}" placeholder="Digite a frase correta aqui...">
                    <button class="individual-reset-button" onclick="resetIndividualOrdering(${index})">Reset</button>
                    <div id="feedback-ordering-${index}" class="feedback"></div>
                `;
                sentenceOrderingContainer.appendChild(orderingItem);
            });
        }

        function resetIndividualOrdering(index) {
            document.getElementById(`ordering-input-${index}`).value = '';
            const feedbackElement = document.getElementById(`feedback-ordering-${index}`);
            if (feedbackElement) {
                feedbackElement.textContent = '';
                feedbackElement.className = 'feedback';
            }
        }

        function checkSentenceOrderingAndGetResults() {
            let correctCount = 0;
            let incorrectCount = 0;
            const incorrectItems = [];

            sentenceOrderingData.forEach((item, index) => {
                const inputElement = document.getElementById(`ordering-input-${index}`);
                const userAnswer = inputElement ? inputElement.value.trim() : '';

                // Normaliza as strings para comparação (remove pontuação, espaços extras, minúsculas)
                const normalize = (str) => str.toLowerCase().replace(/[.,?!]/g, '').replace(/\s+/g, ' ').trim();
                const normalizedUserAnswer = normalize(userAnswer);
                const normalizedCorrectAnswer = normalize(item.correct);

                let isCorrect = (normalizedUserAnswer === normalizedCorrectAnswer);

                if (isCorrect) {
                    correctCount++;
                } else {
                    incorrectCount++;
                    incorrectItems.push({
                        activity: "Ordenar Frases",
                        question: item.scrambled.join(' '),
                        userAnswer: userAnswer,
                        correctAnswer: item.correct,
                        hint: item.hint
                    });
                }
            });
            return { correct: correctCount, incorrect: incorrectCount, incorrectItems: incorrectItems };
        }

        // --- Nova Atividade: Transformação de Frases ---
        const sentenceTransformationData = [
            { sentence: "Alex works with engineers.", transformTo: "Negative", correct: "Alex does not work with engineers.", hint: "Use 'does not' (doesn't) para Present Simple na negativa." },
            { sentence: "Ben is preparing a presentation.", transformTo: "Interrogative", correct: "Is Ben preparing a presentation?", hint: "Comece com 'Is' para Present Continuous na interrogativa." },
            { sentence: "They are not visiting next week.", transformTo: "Affirmative", correct: "They are visiting next week.", hint: "Remova 'not' e mantenha o 'are'." },
            { sentence: "Does Maria like the beaches?", transformTo: "Affirmative", correct: "Maria likes the beaches.", hint: "Remova 'Does' e adicione 's' ao verbo." },
            { sentence: "I am not enjoying the challenges.", transformTo: "Affirmative", correct: "I am enjoying the challenges.", hint: "Remova 'not'." },
            { sentence: "He deals with a lot of paperwork.", transformTo: "Interrogative", correct: "Does he deal with a lot of paperwork?", hint: "Use 'Does' e o verbo na forma base." }
        ];

        const sentenceTransformationContainer = document.getElementById('sentenceTransformationContainer');
        const sentenceTransformationScoreDisplay = document.getElementById('sentenceTransformationScore');

        function generateSentenceTransformation() {
            sentenceTransformationContainer.innerHTML = '';
            sentenceTransformationData.forEach((item, index) => {
                const transformationItem = document.createElement('div');
                transformationItem.className = 'transformation-item';
                transformationItem.innerHTML = `
                    <label>${index + 1}. Frase: "${item.sentence}"</label>
                    <p>Transformar para: <strong>${item.transformTo}</strong></p>
                    <textarea id="transformation-input-${index}" placeholder="Sua frase transformada..."></textarea>
                    <button class="individual-reset-button" onclick="resetIndividualTransformation(${index})">Reset</button>
                    <div id="feedback-transformation-${index}" class="feedback"></div>
                `;
                sentenceTransformationContainer.appendChild(transformationItem);
            });
        }

        function resetIndividualTransformation(index) {
            document.getElementById(`transformation-input-${index}`).value = '';
            const feedbackElement = document.getElementById(`feedback-transformation-${index}`);
            if (feedbackElement) {
                feedbackElement.textContent = '';
                feedbackElement.className = 'feedback';
            }
        }

        function checkSentenceTransformationAndGetResults() {
            let correctCount = 0;
            let incorrectCount = 0;
            const incorrectItems = [];

            sentenceTransformationData.forEach((item, index) => {
                const inputElement = document.getElementById(`transformation-input-${index}`);
                const userAnswer = inputElement ? inputElement.value.trim() : '';

                const normalize = (str) => str.toLowerCase().replace(/[.,?!]/g, '').replace(/\s+/g, ' ').trim();
                const normalizedUserAnswer = normalize(userAnswer);
                const normalizedCorrectAnswer = normalize(item.correct);

                let isCorrect = (normalizedUserAnswer === normalizedCorrectAnswer);

                if (isCorrect) {
                    correctCount++;
                } else {
                    incorrectCount++;
                    incorrectItems.push({
                        activity: "Transformação de Frases",
                        question: `Frase: "${item.sentence}" (Transformar para: ${item.transformTo})`,
                        userAnswer: userAnswer,
                        correctAnswer: item.correct,
                        hint: item.hint
                    });
                }
            });
            return { correct: correctCount, incorrect: incorrectCount, incorrectItems: incorrectItems };
        }

        // --- Nova Atividade: Sinônimos e Antônimos ---
        const synonymAntonymData = [
            { word: "tight", type: "Sinônimo", context: "tight deadline", options: ["loose", "strict", "easy", "flexible"], correct: "strict", explanation: "No contexto de 'tight deadline', 'strict' é o sinônimo mais próximo." },
            { word: "complex", type: "Antônimo", context: "quite complex", options: ["simple", "complicated", "intricate", "difficult"], correct: "simple", explanation: "'Simple' é o antônimo de 'complex'." },
            { word: "essential", type: "Sinônimo", context: "are essential", options: ["unnecessary", "optional", "crucial", "minor"], correct: "crucial", explanation: "'Crucial' significa extremamente importante, assim como 'essential'." },
            { word: "dynamic", type: "Sinônimo", context: "dynamic city", options: ["stagnant", "lively", "boring", "quiet"], correct: "lively", explanation: "Uma cidade 'dynamic' é cheia de vida e energia." },
            { word: "dislike", type: "Antônimo", context: "do you dislike", options: ["hate", "enjoy", "detest", "prefer"], correct: "enjoy", explanation: "'Enjoy' é o antônimo de 'dislike'." },
            { word: "cutting-edge", type: "Sinônimo", context: "cutting-edge technology", options: ["outdated", "old-fashioned", "innovative", "basic"], correct: "innovative", explanation: "'Cutting-edge' significa o mais avançado ou 'innovative'." }
        ];

        const synonymAntonymContainer = document.getElementById('synonymAntonymContainer');
        const synonymAntonymScoreDisplay = document.getElementById('synonymAntonymScore');

        function generateSynonymAntonym() {
            synonymAntonymContainer.innerHTML = '';
            synonymAntonymData.forEach((item, index) => {
                const saItem = document.createElement('div');
                saItem.className = 'synonym-antonym-item';
                let optionsHtml = item.options.map(option => `
                    <label class="inline-flex items-center mr-4">
                        <input type="radio" name="sa-${index}" value="${option}" class="form-radio text-blue-600">
                        <span class="ml-2">${option}</span>
                    </label>
                `).join('');

                saItem.innerHTML = `
                    <label>${index + 1}. Qual é o <strong>${item.type}</strong> de "<span class="flashcard-term">${item.word}</span>" no contexto "${item.context}"?</label>
                    <div class="flex flex-wrap mt-2">
                        ${optionsHtml}
                    </div>
                    <button class="individual-reset-button" onclick="resetIndividualSynonymAntonym(${index})">Reset</button>
                    <div id="feedback-sa-${index}" class="feedback"></div>
                `;
                synonymAntonymContainer.appendChild(saItem);
            });
        }

        function resetIndividualSynonymAntonym(index) {
            const feedbackElement = document.getElementById(`feedback-sa-${index}`);
            if (feedbackElement) {
                feedbackElement.textContent = '';
                feedbackElement.className = 'feedback';
            }
            const radioButtons = document.querySelectorAll(`input[name="sa-${index}"]`);
            radioButtons.forEach(radio => radio.checked = false);
        }

        function checkSynonymAntonymAndGetResults() {
            let correctCount = 0;
            let incorrectCount = 0;
            const incorrectItems = [];

            synonymAntonymData.forEach((item, index) => {
                const selectedOption = document.querySelector(`input[name="sa-${index}"]:checked`);
                const userAnswer = selectedOption ? selectedOption.value : 'Nenhuma resposta';

                let isCorrect = (userAnswer === item.correct);

                if (isCorrect) {
                    correctCount++;
                } else {
                    incorrectCount++;
                    incorrectItems.push({
                        activity: "Sinônimos e Antônimos",
                        question: `Qual é o ${item.type} de "${item.word}" no contexto "${item.context}"?`,
                        userAnswer: userAnswer,
                        correctAnswer: item.correct,
                        explanation: item.explanation
                    });
                }
            });
            return { correct: correctCount, incorrect: incorrectCount, incorrectItems: incorrectItems };
        }


        // --- Lógica do Jogo de Flashcards de Vocabulário ---
        const flashcardVocabularyData = [
            { term: "tight deadline", example: "I am working on a <span class='flashcard-term'>tight deadline</span> for a new substation project.", definition: "Um prazo muito curto para completar uma tarefa." },
            { term: "network upgrade proposals", example: "I am currently reviewing some <span class='flashcard-term'>network upgrade proposals</span>.", definition: "Propostas para melhorar ou expandir uma rede de comunicação." },
            { term: "manage the lifecycle", example: "I <span class='flashcard-term'>manage the lifecycle</span> of electrical infrastructure projects.", definition: "Gerenciar todas as fases de um projeto, do início ao fim." },
            { term: "regulatory compliance", example: "I also deal with a lot of <span class='flashcard-term'>regulatory compliance</span>.", definition: "Estar em conformidade com as regras e leis governamentais." },
            { term: "organizational skills", example: "I believe strong <span class='flashcard-term'>organizational skills</span> are essential.", definition: "Habilidades para planejar e organizar tarefas e recursos de forma eficiente." },
            { term: "detail-oriented", example: "You definitely need to be <span class='flashcard-term'>detail-oriented</span>.", definition: "Ter atenção aos pequenos detalhes." },
            { term: "problem-solving abilities", example: "<span class='flashcard-term'>Problem-solving abilities</span> are also crucial.", definition: "Capacidade de encontrar soluções para problemas." },
            { term: "coordinating different teams", example: "Good communication helps a lot when you are <span class='flashcard-term'>coordinating different teams</span>.", definition: "Organizar e fazer com que equipes diferentes trabalhem juntas." },
            { term: "fiber optic deployments", example: "I am responsible for telecom projects, primarily focusing on <span class='flashcard-term'>fiber optic deployments</span>.", definition: "Instalação de cabos de fibra óptica para internet ou comunicação." },
            { term: "5G network expansions", example: "I am responsible for telecom projects, primarily focusing on <span class='flashcard-term'>5G network expansions</span>.", definition: "Aumento da cobertura ou capacidade de redes 5G." },
            { term: "dynamic city", example: "It’s a very <span class='flashcard-term'>dynamic city</span>, much like Rio.", definition: "Cidade com muita atividade e mudanças." },
            { term: "food scene", example: "São Paulo has an incredible <span class='flashcard-term'>food scene</span>.", definition: "O conjunto de restaurantes, culinárias e cultura gastronômica de um lugar." },
            { term: "typical day", example: "What does a <span class='flashcard-term'>typical day look like</span> for you now?", definition: "Um dia normal ou comum de trabalho." },
            { term: "project dashboards", example: "A typical day still starts with checking emails and <span class='flashcard-term'>project dashboards</span>.", definition: "Painéis visuais que mostram o status e o progresso de projetos." },
            { term: "stand-up meeting", example: "I usually have a <span class='flashcard-term'>stand-up meeting</span> with my team around 9 AM.", definition: "Reunião rápida, geralmente em pé, para discutir o progresso diário." },
            { term: "reviewing progress reports", example: "I spend a lot of time <span class='flashcard-term'>reviewing progress reports</span>.", definition: "Analisar relatórios sobre o andamento de algo." },
            { term: "updating schedules", example: "I spend a lot of time reviewing progress reports, <span class='flashcard-term'>updating schedules</span>, and communicating with stakeholders.", definition: "Atualizar cronogramas." },
            { term: "communicating with stakeholders", example: "I spend a lot of time reviewing progress reports, updating schedules, and <span class='flashcard-term'>communicating with stakeholders</span>.", definition: "Se comunicar com todas as partes interessadas em um projeto." },
            { term: "cybersecurity protocols", example: "Today, I am participating in a workshop on new <span class='flashcard-term'>cybersecurity protocols</span> for our 5G infrastructure.", definition: "Regras e procedimentos para proteger sistemas de computador contra ataques." },
            { term: "constantly adapting", example: "It is a field where you are <span class='flashcard-term'>constantly adapting</span>.", definition: "Estar sempre se ajustando a novas situações ou mudanças." },
            { term: "bureaucratic processes", example: "Sometimes, the <span class='flashcard-term'>bureaucratic processes</span> can be a bit frustrating.", definition: "Procedimentos administrativos complexos e demorados." },
            { term: "cutting-edge technology", example: "I am enjoying the challenges and the opportunity to work with <span class='flashcard-term'>cutting-edge technology</span>.", definition: "Tecnologia mais avançada e inovadora disponível." },
            { term: "major power line upgrade", example: "We are currently celebrating the completion of a <span class='flashcard-term'>major power line upgrade</span>.", definition: "Uma grande melhoria ou modernização em uma linha de energia elétrica." }
        ];

        const flashcardGameContainer = document.getElementById('flashcardGameContainer');
        const flashcardScoreDisplay = document.getElementById('flashcardScore');

        function generateFlashcardVocabulary() {
            flashcardGameContainer.innerHTML = '';
            flashcardVocabularyData.forEach((item, index) => {
                const flashcardItem = document.createElement('div');
                flashcardItem.className = 'flashcard-item';
                flashcardItem.innerHTML = `
                    <label>${index + 1}. Termo: <span class="flashcard-term">${item.term}</span></label>
                    <p class="flashcard-example">Exemplo do diálogo: "${item.example}"</p>
                    <label class="mt-2">Suas anotações/definição:</label>
                    <textarea id="flashcard-notes-${index}" placeholder="Pesquise e anote aqui o que você entendeu..."></textarea>
                    <label class="mt-2">Sua frase com o vocabulário:</label>
                    <textarea id="flashcard-sentence-${index}" placeholder="Crie uma frase original usando '${item.term}'..."></textarea>
                    <button class="individual-reset-button" onclick="resetIndividualFlashcard(${index})">Reset</button>
                    <div id="feedback-flashcard-${index}" class="feedback"></div>
                `;
                flashcardGameContainer.appendChild(flashcardItem);
            });
        }

        function resetIndividualFlashcard(index) {
            document.getElementById(`flashcard-notes-${index}`).value = '';
            document.getElementById(`flashcard-sentence-${index}`).value = '';
            const feedbackElement = document.getElementById(`feedback-flashcard-${index}`);
            if (feedbackElement) {
                feedbackElement.textContent = '';
                feedbackElement.className = 'feedback'; // Resetar classes
            }
        }

        // Função para verificar e retornar resultados, sem exibir feedback imediato
        function checkFlashcardsAndGetResults() {
            let correctCount = 0; // Contagem de itens completamente preenchidos
            let incorrectCount = 0; // Contagem de itens incompletos
            const incorrectItems = [];

            flashcardVocabularyData.forEach((item, index) => {
                const notesInput = document.getElementById(`flashcard-notes-${index}`);
                const sentenceInput = document.getElementById(`flashcard-sentence-${index}`);

                const notesFilled = notesInput.value.trim().length > 0;
                const sentenceFilled = sentenceInput.value.trim().length > 0;

                if (notesFilled && sentenceFilled) {
                    correctCount++;
                } else {
                    incorrectCount++;
                    incorrectItems.push({
                        activity: "Flashcards de Vocabulário de Trabalho",
                        question: `Termo: ${item.term}`,
                        userNotes: notesInput.value.trim(),
                        userSentence: sentenceInput.value.trim(),
                        correctDefinition: item.definition // Mostrar a definição esperada aqui
                    });
                }
            });
            return { correct: correctCount, incorrect: incorrectCount, incorrectItems: incorrectItems };
        }

        // --- Lógica do Modal de Resumo ---
        const summaryModalOverlay = document.getElementById('summaryModalOverlay');
        const overallScoreDisplay = document.getElementById('overallScore');
        const incorrectAnswersSummary = document.getElementById('incorrectAnswersSummary');

        function openSummaryModal() {
            summaryModalOverlay.classList.add('visible');
        }

        function closeSummaryModal() {
            summaryModalOverlay.classList.remove('visible');
            // Opcional: Limpar campos ou reiniciar o jogo aqui
            // location.reload(); // Para reiniciar a página completamente
        }

        // Função para verificar todas as atividades e exibir o resumo
        function checkAllActivities() {
            let totalCorrect = 0;
            let totalIncorrect = 0;
            let allIncorrectDetails = [];

            // Preencher Lacunas
            const fillBlanksResults = checkFillInBlanksAndGetResults();
            totalCorrect += fillBlanksResults.correct;
            totalIncorrect += fillBlanksResults.incorrect;
            if (fillBlanksResults.incorrectItems.length > 0) {
                allIncorrectDetails.push({
                    activity: "Preencher Lacunas",
                    items: fillBlanksResults.incorrectItems
                });
            }

            // Perguntas e Respostas
            const qaResults = checkQAAndGetResults();
            totalCorrect += qaResults.correct;
            totalIncorrect += qaResults.incorrect;
            if (qaResults.incorrectItems.length > 0) {
                allIncorrectDetails.push({
                    activity: "Desafio de Perguntas e Respostas",
                    items: qaResults.incorrectItems
                });
            }

            // Verdadeiro ou Falso
            const trueFalseResults = checkTrueFalseAndGetResults();
            totalCorrect += trueFalseResults.correct;
            totalIncorrect += trueFalseResults.incorrect;
            if (trueFalseResults.incorrectItems.length > 0) {
                allIncorrectDetails.push({
                    activity: "Desafio Verdadeiro ou Falso",
                    items: trueFalseResults.incorrectItems
                });
            }

            // Correção de Erros
            const errorCorrectionResults = checkErrorCorrectionAndGetResults();
            totalCorrect += errorCorrectionResults.correct;
            totalIncorrect += errorCorrectionResults.incorrect;
            if (errorCorrectionResults.incorrectItems.length > 0) {
                allIncorrectDetails.push({
                    activity: "Correção de Erros",
                    items: errorCorrectionResults.incorrectItems
                });
            }

            // Ordenar Frases
            const sentenceOrderingResults = checkSentenceOrderingAndGetResults();
            totalCorrect += sentenceOrderingResults.correct;
            totalIncorrect += sentenceOrderingResults.incorrect;
            if (sentenceOrderingResults.incorrectItems.length > 0) {
                allIncorrectDetails.push({
                    activity: "Ordenar Frases",
                    items: sentenceOrderingResults.incorrectItems
                });
            }

            // Transformação de Frases
            const sentenceTransformationResults = checkSentenceTransformationAndGetResults();
            totalCorrect += sentenceTransformationResults.correct;
            totalIncorrect += sentenceTransformationResults.incorrect;
            if (sentenceTransformationResults.incorrectItems.length > 0) {
                allIncorrectDetails.push({
                    activity: "Transformação de Frases",
                    items: sentenceTransformationResults.incorrectItems
                });
            }

            // Sinônimos e Antônimos
            const synonymAntonymResults = checkSynonymAntonymAndGetResults();
            totalCorrect += synonymAntonymResults.correct;
            totalIncorrect += synonymAntonymResults.incorrect;
            if (synonymAntonymResults.incorrectItems.length > 0) {
                allIncorrectDetails.push({
                    activity: "Sinônimos e Antônimos",
                    items: synonymAntonymResults.incorrectItems
                });
            }

            // Flashcards de Vocabulário
            const flashcardResults = checkFlashcardsAndGetResults();
            totalCorrect += flashcardResults.correct;
            totalIncorrect += flashcardResults.incorrect; // Incompletos contam como incorretos para o total
            if (flashcardResults.incorrectItems.length > 0) {
                allIncorrectDetails.push({
                    activity: "Flashcards de Vocabulário de Trabalho",
                    items: flashcardResults.incorrectItems
                });
            }

            // Atualizar pontuação geral no modal
            overallScoreDisplay.textContent = `Total de Acertos: ${totalCorrect} | Total de Erros/Incompletos: ${totalIncorrect}`;

            // Construir a lista de respostas incorretas no modal
            incorrectAnswersSummary.innerHTML = ''; // Limpar conteúdo anterior
            if (allIncorrectDetails.length > 0) {
                const incorrectTitle = document.createElement('h3');
                incorrectTitle.textContent = 'Respostas Incorretas/Incompletas:';
                incorrectAnswersSummary.appendChild(incorrectTitle);

                allIncorrectDetails.forEach(activityGroup => {
                    const activityTitle = document.createElement('h4');
                    activityTitle.textContent = activityGroup.activity;
                    activityTitle.style.marginTop = '1rem';
                    activityTitle.style.marginBottom = '0.5rem';
                    activityTitle.style.fontWeight = 'bold';
                    activityTitle.style.color = '#334155';
                    incorrectAnswersSummary.appendChild(activityTitle);

                    const ul = document.createElement('ul');
                    activityGroup.items.forEach(item => {
                        const li = document.createElement('li');
                        li.style.marginBottom = '0.75rem';
                        li.style.padding = '0.5rem';
                        li.style.backgroundColor = '#fef2f2';
                        li.style.borderLeft = '4px solid #ef4444';
                        li.style.borderRadius = '0.5rem';

                        if (activityGroup.activity === "Flashcards de Vocabulário de Trabalho") {
                            li.innerHTML = `
                                <strong>Termo:</strong> ${item.question.replace('Termo: ', '')}<br>
                                <span class="user-answer">Suas anotações: "${item.userNotes || 'N/A'}"</span><br>
                                <span class="user-answer">Sua frase: "${item.userSentence || 'N/A'}"</span><br>
                                <span class="correct-answer">Definição esperada: "${item.correctDefinition}"</span>
                            `;
                        } else if (activityGroup.activity === "Desafio Verdadeiro ou Falso") {
                            li.innerHTML = `
                                <strong>Afirmação:</strong> ${item.question}<br>
                                <span class="user-answer">Sua resposta: "${item.userAnswer}"</span><br>
                                <span class="correct-answer">Resposta correta: "${item.correctAnswer}"</span><br>
                                <span class="correct-answer">Explicação: "${item.explanation}"</span>
                            `;
                        } else if (activityGroup.activity === "Correção de Erros" || activityGroup.activity === "Transformação de Frases" || activityGroup.activity === "Ordenar Frases") {
                            li.innerHTML = `
                                <strong>Frase Original/Problema:</strong> "${item.question}"<br>
                                <span class="user-answer">Sua resposta: "${item.userAnswer || 'N/A'}"</span><br>
                                <span class="correct-answer">Resposta correta: "${item.correctAnswer}"</span>
                                ${item.hint ? `<br><span class="correct-answer">Dica: ${item.hint}</span>` : ''}
                                ${item.explanation ? `<br><span class="correct-answer">Explicação: ${item.explanation}</span>` : ''}
                            `;
                        } else if (activityGroup.activity === "Sinônimos e Antônimos") {
                            li.innerHTML = `
                                <strong>Pergunta:</strong> ${item.question}<br>
                                <span class="user-answer">Sua resposta: "${item.userAnswer || 'N/A'}"</span><br>
                                <span class="correct-answer">Resposta correta: "${item.correctAnswer}"</span><br>
                                <span class="correct-answer">Explicação: "${item.explanation}"</span>
                            `;
                        }
                        else {
                            li.innerHTML = `
                                <strong>Pergunta/Frase:</strong> ${item.question}<br>
                                <span class="user-answer">Sua resposta: "${item.userAnswer}"</span><br>
                                <span class="correct-answer">Resposta correta: "${item.correctAnswer}"</span>
                            `;
                        }
                        ul.appendChild(li);
                    });
                    incorrectAnswersSummary.appendChild(ul);
                });
            } else {
                const noIncorrect = document.createElement('p');
                noIncorrect.textContent = 'Parabéns! Você acertou todas as questões!';
                noIncorrect.style.textAlign = 'center';
                noIncorrect.style.color = '#10b981';
                noIncorrect.style.fontSize = '1.1rem';
                incorrectAnswersSummary.appendChild(noIncorrect);
            }

            // Abrir o modal
            openSummaryModal();
        }


        // Inicializar jogos ao carregar a página
        window.onload = function() {
            generateFillInBlanks();
            generateQA();
            generateTrueFalse();
            generateErrorCorrection(); // Nova atividade
            generateSentenceOrdering(); // Nova atividade
            generateSentenceTransformation(); // Nova atividade
            generateSynonymAntonym(); // Nova atividade
            generateFlashcardVocabulary();
        };
    </script>
</body>
</html>

